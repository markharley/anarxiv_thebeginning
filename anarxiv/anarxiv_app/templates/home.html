{% extends "base.html" %}
{% load staticfiles %}

{% block title %} 
	Anarxiv
{% endblock %}


{% block content %}

	<h4> Get the latest papers: </h4>

		<div class="dropdown">
		<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Sub arXiv region
		<span class="caret"></span></button>
		<ul class="dropdown-menu">
			{% for location, name in subAnarxivs.items %}
				<li> <a href="subanarxiv/{{location}}">{{name}}</a>  </li>
			{% endfor %}
		</ul>
		</div>

	<h4> Search the arXiv and inspires: </h4>	

		<form class="form-inline" role="form">
			<div class="form-group">
				<input type="text" id="searchinfo" value="berera">
			</div>
			
			<div class="form-group">	
			<select class="form-control">
			    <option value="Inspires">Inspires</option>
			    <option value="arXiv" selected>arXiv</option>
			    <option value="InsparXiv">InsparXiv</option>
			</select>
			</div>

			<div class="form-group">
				<button class="btn btn-primary" type="button" onclick="Search(0)" id = "searchButton">Search</button>
			</div>
			<div> Summarise the search parameters the search accepts here... at the moment the search accepts firstnames and surnames</div>
		</form>


		<div id = "totalresults" style ="display:none;"> Total number of results: </div>
		<div id = "resultspage"> </div>

		<div id= "searchresults"> <br> </div>

		<div id="spinner" class="spinner" style="display:none;">
				<img id="img-spinner" src="{% static 'images/spinner.gif' %}" alt="Loading"/>
		</div>

		<center><div id = "searchFail" style ="display:none;"> No results found... </div></center>
		<script type="text/javascript" src="{% static 'js/home.js' %}"></script>

{% endblock %}

{% block script %}

function Search(a) {
	
	var selectedSearch = $(".form-control option:selected").val();

	$('#searchFail').css("display","none");
	$('#searchresults').html("");
	$('#totalresults').html("Total number of results: ");
	$('#resultspage').html("");
	$('#nextpage').html("");

	$("#spinner").css("display", "block");


	var x = document.getElementById("searchinfo").value;



		$.ajax({
 		type: "POST",
   		url: "../home/search/",
   		data: {'info': x, 'search': selectedSearch, 'index': a},
   		datatype: "JSON",

   		success: function(data) {
  			$("#spinner").css("display", "none");

  			$('#totalresults').css("display","block");
  			$('#totalresults').append(data['totalResults'])	;

  			
  			if(data['totalResults'] > 50){
  				var num = parseInt(math.ceil(data['totalResults']/50.0));
  				$('#resultspage').append("Page: ");
  				for(var i=0; i< num; i++){

  					$('#resultspage').append("<span class = \"pagenumber\" id = \"i\">" + String(i) + "</span>");
  				}
  			}
  			
  			
 


   			var length = data['htmlList'].length;

   			for(var i =0; i < length; i++){
   				$('#searchresults').append(data['htmlList'][i]);  }
    	},

    	error: function(jqXHR, textStatus, errorThrown) {
    		if(jqXHR.status ==500){
    			$("#spinner").css("display", "none");
    			$('#searchFail').css("display","block");
    		}
		}
     });
};



$(document).on('click',".pagenumber", function(){

		
		var index = $(this).html();
		Search(index);

		

});




















{% endblock %}